<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #scanner-container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        #scanner-video {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
  <form method="post">
    {% csrf_token %}
    <div id="scanner-container">
        <video id="scanner-video"></video>
    </div>
    </form>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>
        const scannerContainer = document.getElementById('scanner-container');
        const scannerVideo = document.getElementById('scanner-video');
        const cameraSelect = document.createElement('select');
        cameraSelect.id = 'camera-select';

        // Get cameras and populate the camera select dropdown
        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                cameras.forEach(camera => {
                    const option = document.createElement('option');
                    option.value = camera.id;
                    option.text = camera.name;
                    cameraSelect.appendChild(option);
                });

                scannerContainer.appendChild(cameraSelect);

                // Function to start scanning with the selected camera
                const startScanning = () => {
                    const selectedCameraId = cameraSelect.value;
                    const selectedCamera = cameras.find(camera => camera.id === selectedCameraId);

                    if (selectedCamera) {
                        const scanner = new Instascan.Scanner({ video: scannerVideo });
                        scanner.addListener('scan', function (content) {
                            // Your scan logic here
                            console.log('Scanned:', content);
                        });
                        scanner.start(selectedCamera);
                    } else {
                        console.error('Selected camera not found.');
                    }
                };

                // Trigger scanning when camera selection changes
                cameraSelect.addEventListener('change', startScanning);

                // Start scanning when the page loads
                startScanning();
            } else {
                console.error('No cameras found.');
            }
        });







    </script>
</body>
</html>

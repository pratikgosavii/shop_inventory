<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #scanner-container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        #scanner-video {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
  <form method="post">
    {% csrf_token %}
    <div id="scanner-container">
        <video id="scanner-video" autoplay playsinline></video>
        <button id="switch-camera-button">Switch Camera</button>
    </div>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>

      
        const scannerContainer = document.getElementById('scanner-container');
const scannerVideo = document.getElementById('scanner-video');
const switchCameraButton = document.getElementById('switch-camera-button');

let currentCameraIndex = 0;
let cameras = [];

// ...

Instascan.Camera.getCameras().then(function (cameraList) {
    cameras = cameraList;

    if (cameras.length > 0) {
        // Start the scanner with the default camera (first available)
        startScannerWithCamera(currentCameraIndex);
    } else {
        console.error('No cameras found.');
    }
});

// Button click event to switch between available cameras
switchCameraButton.addEventListener('click', function () {
    currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
    scanner.stop();
    startScannerWithCamera(currentCameraIndex);
});

// ...

function startScannerWithCamera(cameraIndex) {
    const selectedCamera = cameras[cameraIndex];
    scanner = new Instascan.Scanner({ video: scannerVideo, mirror: false }); // Set mirror to false for rear camera
    scanner.addListener('scan', function (content) {
        content = content || '1';
        console.log('Scanned:', content);
        scanner.stop();
        $.ajax({
            type: "GET",
            url: "{% url 'assign_values_to_qr' 0 %}".replace('0', encodeURIComponent(content)),
            data: {
                'content': content,
                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {
                console.log(data.value);
                if (data.status === "success") {
                    const redirectUrl = data.redirect_url;
                    console.log('Received redirect URL:', redirectUrl);
                    window.location.href = redirectUrl;
                }
            }
        });
    });

    // Start the scanner
    scanner.start(selectedCamera);
}

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>




    </script>
</body>
</html>

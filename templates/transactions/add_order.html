{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCM Example</title>
    <!-- Include Firebase SDK -->

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
        import { getMessaging, getToken, onMessage  } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js'

        // Your Firebase project configuration
		const firebaseConfig = {
            apiKey : "AIzaSyBqaqW0SMq8SPHCWX9QKpShGValpYyV2bs" , 
            authDomain : "namasterapidtax-a92e7.firebaseapp.com" , 
            projectId : "namasterapidtax-a92e7" , 
            storageBucket : "namasterapidtax-a92e7.appspot.com" , 
            messagingSenderId : "1072169977465" , 
            appId : "1:1072169977465:web:7b63186ed7f120943b76a8" , 
            measurementId : "G-VTWK2QSFXM" 
		};
		
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        console.log(app)
        // Get FCM token on page load
        document.addEventListener('DOMContentLoaded', function () {
            const messaging = getMessaging(app);


            // Retrieve Firebase Messaging object.
        
            // Specify the path to the service worker script
            navigator.serviceWorker.register('{% static "firebase-messaging-sw.js"%}').then((registration) => {
              messaging.useServiceWorker(registration);
            }).catch((err) => {
              console.error('Error registering service worker:', err);
            });
        
           

            getToken(messaging, { vapidKey: 'BL0fZe1VjzDW7CJQd4IO9f_OP5AMOAiWBHQ_MxKMl1dVPmiDaWCOJTwCCe89qSlZYSnEgstltOM3sqauY4LARPk' })
                .then((currentToken) => {
                    if (currentToken) {
                        console.log('FCM Token:', currentToken);
                        document.getElementById('token').innerText = currentToken;
                    } else {
                        console.log('No registration token available. Request permission to generate one.');
                    }
                })
                .catch((err) => {
                    console.log('An error occurred while retrieving token:', err);
                });
			});
		
			onMessage(function (payload) {
				console.log("Message received. ", JSON.stringify(payload));
			});

        // Listen for incoming messages
        navigator.serviceWorker.addEventListener('message', (event) => {
			console.log('Received FCM message:', event.data);
			const { title, body } = event.data;

			if (!("Notification" in window)) {
				console.log("This browser does not support desktop notification");
			} else if (Notification.permission === "granted") {
				const notification = new Notification(title, { body });
				// Handle notification click event
				notification.onclick = function () {
					// Handle notification click, e.g., open a specific page
					window.open('https://example.com', '_blank');
				};
			} else if (Notification.permission !== "denied") {
				Notification.requestPermission().then(function (permission) {
					if (permission === "granted") {
						const notification = new Notification(title, { body });
						// Handle notification click event
						notification.onclick = function () {
							// Handle notification click, e.g., open a specific page
							window.open('https://example.com', '_blank');
						};
					}
				});
			}
		});
    </script>
</head>

<body>
    <h1>FCM Example</h1>
    <p>FCM Token: <span id="token"></span></p>
</body>

</html>